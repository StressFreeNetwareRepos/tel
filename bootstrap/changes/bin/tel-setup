#!/usr/bin/env bash
error() {
	printf "\033[0;%sm%s\033[0m\033[0;%sm%s\033[0m\n" "${WHITE}" "[TEL]: " "${RED}" "${1}"
}
remove_data(){
	printf "\033[0;%sm%s\033[0m\033[0;%sm%s\033[0m\n" "${WHITE}" "[TEL]: " "${ORANGE}" "Removing old data..."
	#rm -f ~/.tel/.installed
	rm -rf ~/.tel
	rm -rf ~/.oh-my-zsh
	rm -f ~/.zshrc
}

if [ "$1" == '-h' ] ; then
echo 'usage: tel-setup [OPTION]
	--reset 	deletes all TEL data and installs most decent updates
	--dev 		deletes all TEL data and downloads most decent dev updates'
	exit 0
elif [ "$1" == '--dev' ] ; then
	printf "\033[0;%sm%s\033[0m\033[0;%sm%s\033[0m\n" "${WHITE}" "[TEL]: " "${GREEN}" "Dev version"
	if [ -f "~/.tel/.installed" ]; then
		remove_data
	fi
		branch='dev'
elif [ "$1" == '--reset' ] ; then
	printf "\033[0;%sm%s\033[0m\033[0;%sm%s\033[0m\n" "${WHITE}" "[TEL]: " "${GREEN}" "Resetting & getting latest version"
	remove_data
	branch='master'
else
	branch='master'
fi

if [ ! -f "~/.tel/.installed" ]; then
	pkg install wget unzip coreutils -y 2>&1 || error 'failed to fetch required setup utils'
fi

cd ~/../usr/
wget https://github.com/t-e-l/tel/raw/$branch/bootstrap/changes.zip 2>&1 || error "failed to download update from $branch"
unzip -o changes.zip 2>&1
rm -f changes.zip
chmod +x ~/../usr/bin/tel-setup
chmod +x ~/../usr/bin/tel-applist
bash tel/setup.sh
